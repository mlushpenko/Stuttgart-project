<!-- webshopprocess BPEL Process [Generated by the Eclipse BPEL Designer] -->
<!-- Date: Tue Oct 29 23:40:58 CET 2013 -->
<bpel:process name="webshopprocess"
         targetNamespace="http://webshopprocess"
         suppressJoinFailure="yes"
         xmlns:tns="http://webshopprocess"
         xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
         xmlns:ns="http://imse.soc.grp4.org/inventoryservice" xmlns:ns0="http://www.buyme.com/SOAPPaymentService/" xmlns:ns1="http://www.buyme.com/ShipmentService/">

    <!-- Import the client WSDL -->
	<bpel:import location="webshopprocessArtifacts.wsdl" namespace="http://webshopprocess" 
	        importType="http://schemas.xmlsoap.org/wsdl/" />
         
    <!-- ================================================================= -->         
    <!-- PARTNERLINKS                                                      -->
    <!-- List of services participating in this BPEL process               -->
    <!-- ================================================================= -->         
    <bpel:partnerLinks>
        <!-- The 'client' role represents the requester of this service. -->
        <bpel:partnerLink name="client"
                     partnerLinkType="tns:webshopprocess"
                     myRole="webshopprocessProvider"
                     />
        <bpel:partnerLink name="InventoryLink" partnerLinkType="tns:InventoryPartnerLinkType" partnerRole="InventoryRole"></bpel:partnerLink>
        <bpel:partnerLink name="PaymentService" partnerLinkType="tns:PaymentServiceLinkType" partnerRole="PaymentServiceRole"></bpel:partnerLink>
        <bpel:partnerLink name="ShipmentPartnerLink" partnerLinkType="tns:ShipmentPartnerLinkType" partnerRole="ShipmentPartnerLinkRole"></bpel:partnerLink>
    </bpel:partnerLinks>
  
    <!-- ================================================================= -->         
    <!-- VARIABLES                                                         -->
    <!-- List of messages and XML documents used within this BPEL process  -->
    <!-- ================================================================= -->         
    <bpel:variables>
        <!-- Reference to the message passed as input during initiation -->
        <bpel:variable name="input"
                  messageType="tns:webshopprocessRequestMessage"/>
                  
        <!-- 
          Reference to the message that will be returned to the requester
          -->
        <bpel:variable name="output"
                  messageType="tns:webshopprocessResponseMessage"/>
        <bpel:variable name="clientRequest" messageType="tns:PaymentOptRequest"></bpel:variable>
        <bpel:variable name="clientResponse" messageType="tns:PaymentOptResponse"></bpel:variable>
        <bpel:variable name="clientRequest1" messageType="tns:ShipmentDateRequest"></bpel:variable>
        <bpel:variable name="clientResponse1" messageType="tns:ShipmentDateResponse"></bpel:variable>
        <bpel:variable name="clientRequest2" messageType="tns:ShipmentCostRequest"></bpel:variable>
        <bpel:variable name="clientResponse2" messageType="tns:ShipmentCostResponse"></bpel:variable>
        <bpel:variable name="InventoryLinkResponse" messageType="ns:getProductAvailabilityResponse"></bpel:variable>
        <bpel:variable name="InventoryLinkRequest" messageType="ns:getProductAvailability"></bpel:variable>
        <bpel:variable name="PaymentServiceResponse" messageType="ns0:doPaymentResponse"></bpel:variable>
        <bpel:variable name="PaymentServiceRequest" messageType="ns0:doPaymentRequest"></bpel:variable>
        <bpel:variable name="ShipmentPartnerLinkResponse" messageType="ns1:GetDeliveryDateResponse"></bpel:variable>
        <bpel:variable name="ShipmentPartnerLinkRequest" messageType="ns1:GetDeliveryDateRequest"></bpel:variable>
        <bpel:variable name="ShipmentPartnerLinkResponse1" messageType="ns1:GetAdditionalCostsResponse"></bpel:variable>
        <bpel:variable name="ShipmentPartnerLinkRequest1" messageType="ns1:GetAdditionalCostsRequest"></bpel:variable>
    </bpel:variables>

    <!-- ================================================================= -->         
    <!-- ORCHESTRATION LOGIC                                               -->
    <!-- Set of activities coordinating the flow of messages across the    -->
    <!-- services integrated within this business process                  -->
    <!-- ================================================================= -->         
    <bpel:sequence name="main"><!-- Receive input from requester. 
             Note: This maps to operation defined in webshopprocess.wsdl 
             -->
        <bpel:pick name="Pick" createInstance="yes">
            <bpel:onMessage partnerLink="client" operation="process" portType="tns:webshopprocess" variable="input">
                <bpel:sequence>
                    <bpel:assign validate="no" name="AssignProductID">
                        
                        
                        
                        
                        
                        <bpel:copy>
                            <bpel:from><bpel:literal><tns:getProductAvailability xmlns:tns="http://imse.soc.grp4.org/inventoryservice" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <arg0>0</arg0>
</tns:getProductAvailability>
</bpel:literal></bpel:from>
                            <bpel:to variable="InventoryLinkRequest" part="parameters"></bpel:to>
                        </bpel:copy>
                        <bpel:copy>
                            <bpel:from part="payload" variable="input">
                                <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:input]]></bpel:query>
                            </bpel:from>
                            <bpel:to part="parameters" variable="InventoryLinkRequest">
                                <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[arg0]]></bpel:query>
                            </bpel:to>
                        </bpel:copy>
                    </bpel:assign>
                    <bpel:invoke name="InventoryService" partnerLink="InventoryLink" operation="getProductAvailability" portType="ns:InventoryService" inputVariable="InventoryLinkRequest" outputVariable="InventoryLinkResponse"></bpel:invoke>
                    <bpel:assign validate="no" name="AssignResultBack">
                        <bpel:copy>
                            <bpel:from><bpel:literal><tns:webshopprocessResponse xmlns:tns="http://webshopprocess" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <tns:result>tns:result</tns:result>
</tns:webshopprocessResponse>
</bpel:literal></bpel:from>
                            <bpel:to variable="output" part="payload"></bpel:to>
                        </bpel:copy>
                        <bpel:copy>
                            <bpel:from part="parameters" variable="InventoryLinkResponse">
                                <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[return]]></bpel:query>
                            </bpel:from>
                            <bpel:to part="payload" variable="output">
                                <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                                    <![CDATA[tns:result]]>
                                </bpel:query>
                            </bpel:to>
                        </bpel:copy>
                    </bpel:assign>
                    <bpel:reply name="replyOutput" partnerLink="client" portType="tns:webshopprocess" operation="process" variable="output" />
                </bpel:sequence>
            </bpel:onMessage>
            <bpel:onMessage partnerLink="client" operation="PaymentOpt" portType="tns:webshopprocess" variable="clientRequest">
                <bpel:sequence>
                    <bpel:assign validate="no" name="AssignPaymentInput">
                        <bpel:copy>
                            <bpel:from><bpel:literal><tns:PaymentOptResponse xmlns:tns="http://webshopprocess" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <tns:out>tns:out</tns:out>
</tns:PaymentOptResponse>
</bpel:literal></bpel:from>
                            <bpel:to variable="clientResponse" part="parameters"></bpel:to>
                        </bpel:copy>
                        
                        <bpel:copy>
                            <bpel:from part="parameters" variable="clientRequest">
                                <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                                    <![CDATA[tns:name]]>
                                </bpel:query>
                            </bpel:from>
                            <bpel:to part="name" variable="PaymentServiceRequest">
                            </bpel:to>
                        </bpel:copy>
                        <bpel:copy>
                            <bpel:from part="parameters" variable="clientRequest">
                                <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:address]]></bpel:query>
                            </bpel:from>
                            <bpel:to part="address" variable="PaymentServiceRequest"></bpel:to>
                        </bpel:copy>
                        <bpel:copy>
                            <bpel:from part="parameters" variable="clientRequest">
                                <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:amount]]></bpel:query>
                            </bpel:from>
                            <bpel:to part="amount" variable="PaymentServiceRequest"></bpel:to>
                        </bpel:copy>
                        <bpel:copy>
                            <bpel:from part="parameters" variable="clientRequest">
                                <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:cvc]]></bpel:query>
                            </bpel:from>
                            <bpel:to part="cvc_code" variable="PaymentServiceRequest"></bpel:to>
                        </bpel:copy>
                        <bpel:copy>
                            <bpel:from part="parameters" variable="clientRequest">
                                <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:cardnumber]]></bpel:query>
                            </bpel:from>
                            <bpel:to part="card_number" variable="PaymentServiceRequest"></bpel:to>
                        </bpel:copy>
                        
                    </bpel:assign>
                    <bpel:invoke name="PaymentService" partnerLink="PaymentService" operation="doPayment" portType="ns0:SOAPPaymentService" inputVariable="PaymentServiceRequest" outputVariable="PaymentServiceResponse"></bpel:invoke>
                    <bpel:assign validate="no" name="PaymentResult">
                        <bpel:copy>
                            <bpel:from>
                                <bpel:literal xml:space="preserve"><tns:PaymentOptResponse xmlns:tns="http://webshopprocess" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <tns:out>tns:out</tns:out>
</tns:PaymentOptResponse>
</bpel:literal>
                            </bpel:from>
                            <bpel:to variable="clientResponse" part="parameters"></bpel:to>
                        </bpel:copy>
                        <bpel:copy>
                            <bpel:from part="PaymentResult" variable="PaymentServiceResponse"></bpel:from>
                            <bpel:to part="parameters" variable="clientResponse">
                                <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:out]]></bpel:query>
                            </bpel:to>
                        </bpel:copy>
                    </bpel:assign>
                    <bpel:reply name="Reply" partnerLink="client" operation="PaymentOpt" portType="tns:webshopprocess" variable="clientResponse"></bpel:reply>
                </bpel:sequence>
            </bpel:onMessage>
            <bpel:onMessage partnerLink="client" operation="ShipmentDate" portType="tns:webshopprocess" variable="clientRequest1">
                <bpel:sequence>
                    <bpel:assign validate="no" name="AssignShipmentDate">
                        <bpel:copy>
                            <bpel:from><bpel:literal><tns:ShipmentDateResponse xmlns:tns="http://webshopprocess" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <tns:out>tns:out</tns:out>
</tns:ShipmentDateResponse>
</bpel:literal></bpel:from>
                            <bpel:to variable="clientResponse1" part="parameters"></bpel:to>
                        </bpel:copy>
                        <bpel:copy>
                            <bpel:from part="parameters" variable="clientRequest1">
                                <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:weight]]></bpel:query>
                            </bpel:from>
                            <bpel:to part="Weight" variable="ShipmentPartnerLinkRequest">
                            </bpel:to>
                        </bpel:copy>
                        <bpel:copy>
                            <bpel:from part="parameters" variable="clientRequest1">
                                <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:address]]></bpel:query>
                            </bpel:from>
                            <bpel:to part="Address" variable="ShipmentPartnerLinkRequest"></bpel:to>
                        </bpel:copy>
                        <bpel:copy>
                            <bpel:from part="parameters" variable="clientRequest1">
                                <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:type]]></bpel:query>
                            </bpel:from>
                            <bpel:to part="ShipmentType" variable="ShipmentPartnerLinkRequest"></bpel:to>
                        </bpel:copy>
                        
                    </bpel:assign>
                    <bpel:invoke name="ShipmentDate" partnerLink="ShipmentPartnerLink" operation="GetDeliveryDate" portType="ns1:ShipmentService" inputVariable="ShipmentPartnerLinkRequest" outputVariable="ShipmentPartnerLinkResponse"></bpel:invoke>
                    <bpel:assign validate="no" name="AssignShipmentDateResults">
                        <bpel:copy>
                            <bpel:from><bpel:literal><tns:ShipmentDateResponse xmlns:tns="http://webshopprocess" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <tns:out>tns:out</tns:out>
</tns:ShipmentDateResponse>
</bpel:literal></bpel:from>
                            <bpel:to variable="clientResponse1" part="parameters"></bpel:to>
                        </bpel:copy>
                        <bpel:copy>
                            <bpel:from part="DeliveryDate" variable="ShipmentPartnerLinkResponse"></bpel:from>
                            <bpel:to part="parameters" variable="clientResponse1">
                                <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:out]]></bpel:query>
                            </bpel:to>
                        </bpel:copy>
                    </bpel:assign>
                    <bpel:reply name="ReplyPaymentResults" partnerLink="client" operation="ShipmentDate" portType="tns:webshopprocess" variable="clientResponse1"></bpel:reply>
                </bpel:sequence>
            </bpel:onMessage>
            <bpel:onMessage partnerLink="client" operation="ShipmentCost" portType="tns:webshopprocess" variable="clientRequest2">
                <bpel:sequence>
                    <bpel:assign validate="no" name="Assign3">
                        <bpel:copy>
                            <bpel:from><bpel:literal><tns:ShipmentCostResponse xmlns:tns="http://webshopprocess" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <tns:out>tns:out</tns:out>
</tns:ShipmentCostResponse>
</bpel:literal></bpel:from>
                            <bpel:to variable="clientResponse2" part="parameters"></bpel:to>
                        </bpel:copy>
                        <bpel:copy>
                            <bpel:from part="parameters" variable="clientRequest2">
                                <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:address]]></bpel:query>
                            </bpel:from>
                            <bpel:to part="Address" variable="ShipmentPartnerLinkRequest1">
                            </bpel:to>
                        </bpel:copy>
                        <bpel:copy>
                            <bpel:from part="parameters" variable="clientRequest2">
                                <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:weight]]></bpel:query>
                            </bpel:from>
                            <bpel:to part="Weight" variable="ShipmentPartnerLinkRequest1"></bpel:to>
                        </bpel:copy>
                        <bpel:copy>
                            <bpel:from part="parameters" variable="clientRequest2">
                                <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:type]]></bpel:query>
                            </bpel:from>
                            <bpel:to part="ShipmentType" variable="ShipmentPartnerLinkRequest1"></bpel:to>
                        </bpel:copy>
                    </bpel:assign>
                    <bpel:invoke name="ShipmentCost" partnerLink="ShipmentPartnerLink" operation="GetAdditionalCosts" portType="ns1:ShipmentService" inputVariable="ShipmentPartnerLinkRequest1" outputVariable="ShipmentPartnerLinkResponse1"></bpel:invoke>
                    <bpel:assign validate="no" name="Assign">
                        <bpel:copy>
                            <bpel:from><bpel:literal><tns:ShipmentCostResponse xmlns:tns="http://webshopprocess" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <tns:out>tns:out</tns:out>
</tns:ShipmentCostResponse>
</bpel:literal></bpel:from>
                            <bpel:to variable="clientResponse2" part="parameters"></bpel:to>
                        </bpel:copy>
                        <bpel:copy>
                            <bpel:from part="AdditionalCosts" variable="ShipmentPartnerLinkResponse1"></bpel:from>
                            <bpel:to part="parameters" variable="clientResponse2">
                                <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:out]]></bpel:query>
                            </bpel:to>
                        </bpel:copy>
                    </bpel:assign>
                    <bpel:reply name="Reply2" partnerLink="client" operation="ShipmentCost" portType="tns:webshopprocess" variable="clientResponse2"></bpel:reply>
                </bpel:sequence>
            </bpel:onMessage>
        </bpel:pick>
        
        
        <!-- Generate reply to synchronous request -->
        
    
    </bpel:sequence>
</bpel:process>

